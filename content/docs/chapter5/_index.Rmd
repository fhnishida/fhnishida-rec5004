---
date: "2018-09-09T00:00:00Z"
# icon: book
# icon_pack: fas
linktitle: Data Visualization
summary: Learn how to use Wowchemy's docs layout for publishing online courses, software
  documentation, and tutorials.
title: Data Visualization
weight: 5
output: md_document
type: book
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

- [Exploratory graphs - Part 1 (John Hopkins/Coursera)](https://www.coursera.org/learn/exploratory-data-analysis/lecture/ilRAK/exploratory-graphs-part-1)
- [Base plotting system - Part 2 (John Hopkins/Coursera)](https://www.coursera.org/learn/exploratory-data-analysis/lecture/m4P1I/base-plotting-system-part-2)
- [Base plotting demonstration (John Hopkins/Coursera)](https://www.coursera.org/learn/exploratory-data-analysis/lecture/yUFDH/base-plotting-demonstration)

- [Aplica√ß√µes R Base (The R Graph Gallery)](https://r-graph-gallery.com/base-R.html)
- Objetivos dos gr√°ficos em an√°lise de dados:
    1. Entender as propriedades dos dados
    2. Encontrar padr√µes nos dados
    3. Sugerir estrat√©gias de modelagem
    4. Analisar "bugs"
    5. Comunicar resultados
    

## An√°lise Explorat√≥ria de Dados (EDA)
- Os gr√°ficos para an√°lise explorat√≥ria abrangem os 4 primeiros objetivos, ou seja, n√£o s√£o para comunicar um resultado final do seu trabalho.
- Caracter√≠sticas:
    1. Feitas rapidamente e em grande quantidade
    2. O objetivo √© o entendimento dos dados
    3. Eixos/legendas normalmente s√£o retiradas
    4. Cores/tamanhos s√£o primariamente usadas para informa√ß√£o
- Principais gr√°ficos simples:
    a. Diagrama de caixa (_Boxplot_)
    b. Histogramas
    c. Gr√°fico de barra (_Barplot_)
    d. Gr√°fico de dispers√£o (_Scatterplot_)

Como exemplo, usaremos dados da Ag√™ncia de Prote√ß√£o Ambiental dos EUA (EPA), [avgpm25.csv](https://fhnishida.github.io/fearp/eco1/avgpm25.csv), que informa a quantidade de polui√ß√£o por part√≠cula fina (PM2.5). A m√©dia anual de PM2.5 que n√£o pode exceder 12 $\mu g/m^3$. 

```{r}
library(dplyr)
pollution = read.csv("https://fhnishida.github.io/fearp/eco1/avgpm25.csv")
summary(pollution)
# https://fhnishida.netlify.app/docs/avgpm25.csv
```

### Diagrama de caixa (_Boxplot_)
- Apresenta m√≠nimo, m√°ximo, os quartis e outliers.
```{r}
boxplot(pollution$pm25, col="blue")
abline(h=12, col="red") # Linha horizontal no valor 12
```
- Para m√∫ltiplos boxplots, usamos `<vari√°vel_num√©rica> ~ <vari√°vel categ√≥rica>`:

```{r}
boxplot(pollution$pm25 ~ pollution$region, col="blue")
abline(h=12, col="red") # Linha horizontal no valor 12
```



### Histograma
```{r}
hist(pollution$pm25, col="green")

hist(pollution$pm25, col="green", breaks=100) # 100 quebras
rug(pollution$pm25) # Tra√ßos dos valores da amostra abaixo do histograma 
abline(v=12, col="red") # Linha vertical no valor 12
```
- Podemos colocar mais de um gr√°fico numa figura usando a fun√ß√£o `par(mfrow, mar)`:
```{r}
par(mfrow=c(2, 1), mar=c(4, 4, 2, 1)) # Criando figura com 2 linhas e 1 coluna + margens

pol_west = pollution %>% filter(region == "west")
pol_east = pollution %>% filter(region == "east")

hist(pol_west$pm25, col="green")
hist(pol_east$pm25, col="green")
```

- Note que voc√™ precisa usar `par(mfrow=c(1, 1))` para voltar a incluir apenas 1 gr√°fico na figura. 


### Gr√°fico de barra (_Barplot_)
```{r}
barplot(table(pollution$region), col="wheat",
        main="N¬∫ de pa√≠ses em cada regi√£o")
```



### Gr√°fico de dispers√£o (_Scatterplot_)
- Gera gr√°ficos sob 2 dimens√µes
```{r}
plot(pollution$latitude, pollution$pm25)
abline(h=12, lwd=1.5, lty=2, col="red")
abline(lm(pm25 ~ latitude, data=pollution), col="blue")
```

```{r}
par(mfrow=c(1, 2), mar=c(4, 4, 2, 1)) # Criando figura com 1 linha e 2 colunas + margens

plot(pol_west$latitude, pol_west$pm25, main="West")
plot(pol_east$latitude, pol_east$pm25, main="East")
```

- Tamb√©m √© poss√≠vel adicionar objetos gr√°ficos e textos no gr√°fico gerado por `plot()`:
    - `abline()`: adiciona linhas horizontal, vertical ou de regress√£o
    - `points()`: adiciona pontos ao gr√°fico
    - `lines()`: adiciona linhas ao gr√°fico
    - `text()`: adiciona texto ao gr√°fico
    - `title()`: adiciona anota√ß√µes aos eixos, t√≠tulo, subt√≠tulo e margem exterior
    - `mtext()`: adiciona texto √†s margens (interna e externa) do gr√°fico
    - `axis()`: adiciona tra√ßos/r√≥tulos aos eixos

```{r}
par(mfrow=c(1, 1)) # Retornando ao padr√£o

air_may = airquality %>% filter(Month==5)
air_other = airquality %>% filter(Month!=5)

plot(airquality$Wind, airquality$Ozone, main="Ozone and Wind in NYC")
points(air_may$Wind, air_may$Ozone, col="blue")
points(air_other$Wind, air_other$Ozone, col="red")
legend("topright", pch=1, col=c("blue", "red"), legend=c("May", "Other Months"))
```


Alguns par√¢metros gr√°ficos importantes:

- `pch`: s√≠mbolo dos pontos gr√°ficos (padr√£o √© c√≠rculo)
- `lty`: tipo da linha (padr√£o √© linha s√≥lida, mais pode ser pontilhado, etc.)
- `lwd`: grossura da linha (integer)
- `col`: cor, especificada como n√∫mero, texto ou c√≥digo hex (fun√ß√£o `colors()` d√° um vetor de cores por nome)
- `xlab`: r√≥tulo do eixo x
- `ylab`: r√≥tulo do eixo y
- `par()`: fun√ß√£o que especifica par√¢metros *globais* que afetam todas figuras:
    - `las`: orienta√ß√£o dos r√≥tulos 
    - `bg`: cor de fundo
    - `mar`: tamanho da margem
    - `oma`: tamanho da margem externa (padr√£o √© 0)
    - `mfrow`: n√∫mero de gr√°ficos por linha
    - `mfcol`: n√∫mero de gr√°ficos por coluna



## Grammar of Graphics (`ggplot2`)
- [_ggplot2_ - Part 3 (John Hopkins/Coursera)](https://www.coursera.org/learn/exploratory-data-analysis/lecture/idcsq/ggplot2-part-3)
- [_ggplot2_ - Part 4 (John Hopkins/Coursera)](https://www.coursera.org/learn/exploratory-data-analysis/lecture/cj6RA/ggplot2-part-4)
- [_ggplot2_ Cheat Sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf)
- [Aplica√ß√µes _ggplot2_ (The R Graph Gallery)](https://r-graph-gallery.com/ggplot2-package.html)


- Componentes b√°sicos do `ggplot2`:
    - um **data frame**
    - est√©tica (**aesthetics**): como os dados s√£o mapeados (tamanho, forma, cor)
    - objetos geom√©tricos (**geoms**): pontos, linhas, formas
    - **facets**: para gr√°ficos condicionais
- Ao inv√©s de criar um gr√°fico diretamente, os gr√°ficos do `ggplot2` s√£o constru√≠dos em camadas (layers)



1. Data Frame
```{r}
head(mtcars)
```

2. Base do Gr√°fico (`ggplot()`)
    - dados que ser√£o inclu√≠dos no gr√°fico
    - toda vez que for incluir uma vari√°vel, √© necess√°rio precisa usar a fun√ß√£o `aes()` sobre elas
```{r}
library(ggplot2)
g = ggplot(data=mtcars, aes(mpg, wt)) # Criando a base do gr√°fico
g
```

3. Layer geom√©tico (`geom`)
    - incluindos formas, linhas e pontos
    - caso n√£o sejam informadas novas vari√°veis, a fun√ß√£o para criar um objeto geom√©trico ir√° usar as vari√°veis-base definidas na fun√ß√£o `ggplot()` inicial
    - Junta-se a base do gr√°fico com outras layers usando o sinal `+`
```{r}
g + geom_point()
```

4. Layer de suaviza√ß√£o/tend√™ncia (`smooth`)
```yaml
geom_smooth(
  mapping = NULL, data = NULL, ...,
  method = NULL, formula = NULL, se = TRUE, level = 0.95
)

mapping: Set of aesthetic mappings created by aes() or aes_(). If specified and inherit.aes = TRUE (the default), it is combined with the default mapping at the top level of the plot. You must supply mapping if there is no plot mapping.
data: The data to be displayed in this layer. If NULL, the default, the data is inherited from the plot data as specified in the call to ggplot().
method: Smoothing method (function) to use, accepts either NULL or a character vector, e.g. "lm", "glm", "gam", "loess" or a function (...).
formula: Formula to use in smoothing function, eg. y ~ x, y ~ poly(x, 2), y ~ log(x).
se: Display confidence interval around smooth? (TRUE by default, see level to control.)
level: Level of confidence interval to use (0.95 by default).
```

```{r}
g + geom_point() + geom_smooth(method="lm") # suaviza√ß√£o a partir de OLS
```



5. Layers condicionais
Facets (usar `cyl`)

```{r}
g + geom_point() + geom_smooth(method="lm") + facet_grid(. ~ cyl) # agrupando por n¬∫ cilindros horizontalmente
g + geom_point() + geom_smooth(method="lm") + facet_grid(cyl ~ .) # agrupando por n¬∫ cilindros verticalmente
```

6. Anota√ß√µes
    - R√≥tulos: `xlab()`, `ylab()`, `labs()`, `ggtitle()`
    - Cada _geom_ tem op√ß√µes para modificar, mas use `theme()` para op√ß√µes globais do gr√°fico. Use `?theme` e veja a quantidade de configura√ß√µes voc√™ pode fazer no seu gr√°fico.
    - Se quiser temas pr√©-definidos, h√° 2 templates padr√£o `theme_gray()` e `theme_bw()` (preto/branco). Tamb√©m √© poss√≠vel usar outros usando o pacote `ggthemes`.
```{r}
g + geom_point() + ggthemes::theme_economist() + 
    ylab("Peso (libras)") + xlab("Milhas por gal√£o") +
    ggtitle("Milhas por gal√£o X Peso do carro")
```


7. Modificando Est√©tica
    - Dentro de cada _geom_, podemos definir a cor (`color`), o tamanho (`size`) e a transpar√™ncia (`alpha`)
```{r}
g + geom_point(color="steelblue", size=9, alpha=0.4)
g + geom_point(aes(color=cyl), size=9, alpha=0.4) # colorindo por vari√°vel - precisa usar aes()
```



{{< cta cta_text="üëâ Proceed to Distributions" cta_link="../chapter6" >}}